<!doctype linuxdoc system>

<!-- Automount mini-howto -->

<article>

<!-- Title information -->

<title>Automount mini-Com
<author> Rahul Sundaram, <url url="mailto:Rahulsundaram AT yahoo DOT co DOT in" name="rahulsundaram@yahoo.co.in">
<date>v1.6, 2002-12-27
<abstract>
Aquest fitxer desciu l'autofs automounter, com configurar-lo, i assenyala alguns
problemes a evitar.
</abstract>

<!-- Table of contents -->
<toc>

<!-- Begin the document -->

<sect>Introducció
<sect1> Historial de Revisions
<p>
<itemize>
<item> Versions per baix de la 1.5 - Escrit per Don.
<item> Version 1.5   - Afegit el copyright i altres detalls menors. Rahul 
Sundaram prengé el manteniment.
<item> Version 1.5.1 - Afegits detalls a la qüestió sobre el VFAT.
<item> Version 1.5.2 - Historial de revisions i altres correccions menors.
<item> Version 1.6 - Afegides algunes preguntes i respostes.
</itemize>
</p>

<sect1> Automuntatge - què i perquè?
<p>
L'automuntatge és el procés mitjançant el qual muntatge i el
desmuntatge de certs sistemes de fitxers es fa automàticament
mitjançant un dimoni. Si el sistema de fitxers es desmunta i un usuari
tracta d'acccedir-lo, aquest es (re)munta. Açò és especialment útil en
grans entorns en xarxa i per muntatges encreuats de sistemes de
fitxers entre unes poques màquines (especialment unes que no estàn
sempre en línia). Podria ser també molt útil per a dispositius
desmuntables, o per a uns pocs altres usos, com l'intercanvi fàcil
entre el muntatge amb conversió ascii forçada d'un sistema de fitxers
dos i un muntatge sense conversió ascii del mateix sistema de fitxers
dos. Si vostè és nou en Linux i no entén que són els dimonis ni el
muntatge, aleshores referisca's a alguna documentació sobre el tema.

<sect1>Tipus d'automountatge
<p>Hi ha dos tipus d'automountadors a linux; <em>AMD</em>
 i <em>autofs</em>. AMD és el dimoni d'automuntatge, i suposadament
 treballa com el SunOS AMD. Està implementat en l'espai d'usuari, el
 que significa que no forma part del núcli. No és necessari que el 
 núcli entenga l'automuntatge si vostè munta la seua màquina local, a
 través del sistema NFS mitjançant el dimoni AMD, que enruta tot el
 tràfic del sistema de fitxers automout a través del sistema
 NFS. Autofs és un nou sistema assistit pel núcli, el que significa
 que el codi del sistema de fixers del núcli sap on estàn els punts 
 de muntatge automount en un sistema de fitxers underlying normal, i
 el programa automout o agafa d'ahí. Només autofs serà descrit en
 aquest mini-com.

<sect>Administrative
<sect1>Informació de Copyright
<p>
Aquest mini-COM és un Copyright  Rahul Sundaram Sundaram.Tots els
drets reservat. Aquest document està llicentat baix la 
<url url="http://tldp.org/copyright.html" 
name="Linux Documentation Project license">. Agrairé tota mena de
  distribució comercial, però m'agradaria rebre informació al
  respecte. També ajudaria a qualsevol interessat en traduir aquest
  document. Si requereix alguna excepció als termes de la llicència,
  per favor contacte amb mi 
  <url url="mailto:Rahulsundaram AT yahoo DOT co DOT in" 
  name="Rahul Sundaram">. La última versió d'aquest document està
  sempre disponible al lloc web de Linux Documentation
  <url url="http://tldp.org/HOWTO/mini/Automount.html">.

<sect1>Disclaimer
<p>
Malgrat que he intentat fer-ho el millor possible tat per a dur a
terme aquest com de la millor manera, no em faig responsable de cap 
dany causat per les accions preses basades en la informació continguda 
en aquest document. És impossible provar les coses baix totes les
configuracions, així que probablement algunes de les pistes ofertes en
aquest document poden ser incorrectes i potser no funcionen al seu
sistema. En el cas de que vostè trobe alguna cosa malament, faça-m'ho
saber primer. Jo ho reescriuré tan aviat com em siga possible.

Aquest document es proporciona ``tal qual''. He posat un gran esforç
en escriure'l tan precís com he pogut, però vostè utilitza
la informació continguda en ell baix el seu pròpi risc. En cap cas
seré resoponsable dels danys resultants de l'ús d'aquest treball.

<sect>Instal·lació
<p>
Autofs és implementat en l'espai del núcli, pel que el seu núcli ha de
tindre el suport compilat en ell. Totes les versions del núcli a
partir de la 2.2.xx suporten autofs.

<p>El programa automount i els seus fitxers de configuració també
  seràn necessàris; utilitzant el rpms. La distribució RedHat té
  aquest paquet disponible com a part de la instal·lació.

<sect>Configuració
<p>Instal·lant els paquets RPM et portaràn a aquest punt prou
  fàcilment, però ací està la part de la vostè potser no està segur
  si no ha fet açò abans.

<p>Hi ha dos fitxers a /etc, un anomenat <tt>auto.master</tt> i un
  anomenat <tt>auto.misc</tt>. Un auto.master d'exemple seria així:
<verb>
/auto   /etc/auto.misc  --timeout=60
</verb>
<p>La primera entrada no és el punt de muntatge. És on el conjunt de
  punts de muntatge (que es troben en la segona entrada) va a
  estar. La tercera opció diu que els sistemes muntats poden provar a
  desmuntar-se ells mateixos 60 segons després del seu ús. Vostè haurà
  de deixar d'utilitzar el disc abans de desmuntar-lo.
<p>
Auto.misc és un "fitxer de mapeig". El fitxer de mapeig pot tindre
qualsevol nom; aquest es diu auto.misc perquè originalment controlava
/misc. Es poden definir múltiples fitxers de mapeig a auto.master.
El meu auto.misc s'assembla a açò:
<verb>
kernel          -ro,soft,intr           ftp.kernel.org:/pub/linux
cd              -fstype=iso9660,ro      :/dev/cdrom
zip             -fstype=auto            :/dev/hdd4
floppy          -fstype=vfat            :/dev/fd0
</verb>
<p>
La primera columna (la "clau") és el punt de muntatge. En aquest cas
seria /auto/floppy o el que siga. El conjunt central són les opcions;
llija la pàgina de manula de mount per més detalls sobre açò. I la
última columna especifica d'on vé el sistema de fitxers. La entrada
"kernel" se suposa què és un muntatge NFS. El caràcter : a totes les
altres línies significa què és un un dispositiu local.


<sect>El llarg camí del desmuntatge
<p>
Alguns de vostès potser miren aquells 60 segons de compte enrere i
pensen, <em>això és molt de temps esperant per a expulsar un
disquet. Potser tan sols sincronitze els discos, l'expulse muntat i
ningú se n'adonarà.</em> Deixem suggerir <tt>alternative més
sanes</tt>. Primer de tot, vostè pot canviar el compte enrere. Però
això pot ser una miqueta ineficient; dient-li al sistema que desmunte
coses després de 15 segons o el que siga. Depenent de la seua
configuració But that, vostè pot estar capacitat per a senzillament
executar la ordre umount com a usuari normal. Però hi ha, de fet, una
manera de demanar al programa automout que desmunte. Si vostè envia
(amb el programa kill) la senyal <tt>SIGUSR1</tt> al procés automount,
aquest desmuntarà tot allò que puga. Però abans de que la gent començe
a fer-se botons d'automuntatge als seus gestors de finestres, hi ha un
xicotet problema.
<p>
El procés automout s'executa pel root, i només acceptarà senyals del
root. La meitat de la raó per la que probablement vostè està fent
automountatge és perquè li permet muntar i desmuntar sense ser
root. Seria fàcil fer un programa suid-root en C que fes la faena
bruta. Tanmateix, utilitzant sudo és possible permetre a usuaris
enviar la senyal kill apropiada. L'únic problema és que sudo no li
permetrà utilitzar les subordres de processos que vostè hauria de fer
per a trobar el PID actual. Vostè hauria de tindre un programa
anomenat killall, que li permetria fer açò: 

<verb>
ALL     ALL=NOPASSWD:/usr/bin/killall -USR1 automount
</verb>
En cas contrari, vostè hauria de permetre als seus usuaris enviar
-SIGUSR1 a tots els processos.  Això te vàris efectes en programes;
reciclarà alguns gestors de finestres, però matarà xemacs. Així que
So here's hoping there's no buffer overruns in killall...

<sect>Preguntes
<p>

<sect1>No veig /auto/floppy, ni cap punt de muntatge que busque, siga
  el que siga.

<p>
Si automount està configurat adeqüadament, siga quin siga el punt de
muntatge que està buscant estarà ahi, si vostè prova a utilitzar-lo,
tot i que no el veja quan no està en ús. Si vostè està navegant pel
directori amb una eina gràfica, podria necessitar escriure el nom
manualment; la majoria de programes provaràn el que els dones, i la
unitat serà muntada abans de que se n'adone. Desafortunadament no
poder triar els punts de muntatge invisibles és probablement el major
desavantatge d'autofs. Si realment bugs you, edite els fitxers de
configuració. (Pista, els que acaben en .c com a "configuration")

Una solució qeu vàries persones han triat és crear un enllaç simbòlic
on automount crearà alguna cosa una vegada la munte. Açò probablement
previndrà que el programa es queixe de que un directori no existeix
(si el muntatge funciona) però els llistats de directori descuidats
causaràn que els sistemes de fitxers siguen muntats.

<sect1>Com veig quès està muntat?
<p>
La ordre <tt>df</tt>. <tt>mount</tt> sense opcions farà el mateix,
però a més mostrarà les opcions amb les que es va muntar.



<sect1>Jo pose un disc win95 ("vfat") i és detectat com un disk fat
normal.
<p>
Açò no és un problema amb automount. El tipus de sistema de fitxers
"auto" no intenta un muntatge vfat abans de muntar amb èxit un sistema
de fitxers MS-DOS. VFAT és una extensió del sistema de fitxers FAT
bàsic per tal de proporcionar-li a Windows 95 i Windows NT noms llargs
de fitxer.
<p>
Segons un dels autors de mount, com mount és només un wrapper al
vontant d'una crida del sistema que ha d'especificar el tipus de
sistema de fitxers, continúa sent responsibilitat de l'usuari arribar
amb el tipus de sistema de fitxers. Having mount take a list of
filesystems to try in order, rather than the current "heuristic" is
under consideration. Alguns usuaris senzillament no tenenn msdos
compilat dins del núcli; açò evita que siga provat abans d'vfat. Açò
funcionarà per a la majoria de gent; uns pocs necessiten el sistema de
fitxers msdos i, de fet, hi ha una solució. Vostè ha de copiar el
fitxer /proc/filesystems com /etc/filesystems i editar-lo per a
canviar l'ordre de manera que vfat aparega abans que msdos. (Gràcies
Mark)

Ariel(aslinux At dsgml.com) escriu 

" o faça que mount prove vfat abans de fat, senzillament cree o edite
el fitxer /etc/filesystems

Lliste, per ordre de prioritat, quins sistemes de fitxers vol que el
tipus de sistema de fitxers 'auto' prove.

Cree el fitxer amb cp /proc/filesystems /etc/filesystems.

Edite la llista per a canviar l'ordre. Pose primer els tipus de sistema de
fitxers que són detectats amb molta seguretat com  ext2 (el que
significa que es poden comprovar molt ràpidament), i aquells que són
més comuns per a vostè. Senzillament pose vfat abans de msdos i vostè
estarà llest. Assegure's de posar-los els dos, en el cas de que vostè
estiga muntant alguna cosa que no siga vfat.

El meu es pareix a:

ext2
vfat
msdos
iso9660

****

Jo utilitze un timeout de 1 segon per als dispositius removable. Cree
mapes separats, separats pel timeout que necessite.

You're thinking 1 second? That wastes a lot of resources - but it
doesn't.
Remember that the system only unmounts when it's no longer in use.

So a 1 second unmount means, as soon as no one is using the device,
it's
unmounted.

Also, be very sure to put 'sync' as an option for the floppy!

i.e.

floppy      -fstype=auto,sync,user,umask=002,gid=floppy     :/dev/fd0"

Això hauria de deixar clara la resposta.

<sect1>El meu sistema de fitxers <tt>/auto/grumblesmurf</tt> està
  muntat i <tt>kill -SIGUSR1</tt> no el desmunta.
<p>
Està sent utilitzat per alguna cosa. Root probablement tampoc el pot
desmuntar manualment. Si és vostè qui ha provocat el seu muntatge (és
a dir, que no pot ser que algú altre l'estiga utilitzant) busque un
shell que podria estar en eixe directori. Si no n'hia ha cap, busque
alguna altra cosa (particularment alguna cosa que podria haver anat a
a través d'eixe directori, com un navegador de directoris) que podria
haver deixat un peu invisible en la porta per dir-ho així. Si s'ha
rendit de buscar, prove a utilitzar el programa fuser.

<sect1>Què passa si jo definisc el directori / com el directori per a
l'automounter
<p>
Jo no ho recomane. Si vostè vol /grumblesmurf, aleshores li suggerisc
un enllaç simbòlic. Serà molt més segur.

<sect1>Puc tindre dos fitxers de mapeig en el mateix directori?
<p>
Fins on jo sé, no. Prove a utilitzar un fitxer de mapeig, amb opcions
específiques per a entrades individuals.

<sect1>Estic utilitzant SuSE 6.0 i he necessitat <tt>---timeout</tt>
enlloc de <tt>--timeout</tt>
<p>
Una altra solució als problemes tipus "timeout no funciona" seria
afegir una opció <tt>-t time</tt> a l'script d'autofs.

<sect1>Com definisc els permisos i propietari per al sistema de
  fitxers (p.ex.)FAT.
<p>
Consulte la pàgina man de mount per a for algunes de les opcions, com
definir les opcions el uid=valor o umask=valor. Una opció que sembla
estar perduda per als sistemes de fitxers FAT és mode=value. Ho
sent. Comprove-ho amb la gent que fa muntatges.

<sect1>Com navegar pel contingut d'un directori autofs, quan els
  subdirectoris no estàn actualment muntats?

Philippe Froidevaux <url url="mailto:philippe.froidevaux@unifr.ch"
name="philippe.froidevaux AT unifr.ch"> escriu
<p>

		" L'autor d'autofs diu "de cap manera"

un possible hack és (del grup de notícies) : "

"no munte a  /home/blauser  sino a  /mount/.auto/blauser
i affig un enllaç   /home/blauser -> /mount/.auto/blauser

ara vostè pot navegar dins de /home i veure el directori llar dels
usuaris, aquest és muntat quen vostè hi accedeix.

el problema amb açò: no és tan net i necessita feina per a cada usuari.

una altra solució consisteix a utilitzar 'amd' enlloc de 'autofs',
però amb té menys rendiment".



<sect1>A qui li agraïsc per autofs?
<p>
Açò només és una documentació proporcionada per a vostè per a cridar
l'atenció de tothom de la gran feina que s'ha fet amb autofs, i lo
fàcil què és d'utilitzar. Comparat amb els autors originals d'AMD,
l'autofs està molt ben documentat i els executors tenen el meu sinzer
agraïmet.  Tota ha sigut copyrighted per la empresa Transmeta amb la
qual cosa no és possible proporcionar un llista de crèdits, però Peter
Anvin és probablement responsable d'una bona part d'ell. Peter a més
celebrar una sessió sobre autofs a la linuxworldexpo el 3 de Març de
1999.

<sect1>On puc aprendre més sobre automountatge?
<p>
Hi ha un tutorial d'autofs a <url url="http://www.linuxhq.com/lg/issue24/nielsen.html">.
Mire també am-utils a <url url="http://www.cs.columbia.edu/~ezk/am-utils">

<sect1>On contactar amb els desenvolupadors?. Hi ha una llista de
  correu per a autofs?
<p>
No he pogut trobar cap informació al respecte. Per favor faça-m'ho
saber si vostè es troba amb alguna cosa.

<sect>Agraïemts, aportacions i dedicació
<p>
M'agradaria agraïr a <url url="mailto:don@sabotage.org" name="Don">
(l'identificador del correu sembla ser vàlid ara) pel seu treball
original en aquest mini-COM. Li agraïsc a Ariel per la seua resposta
respecte a la pregunta sobre "win95 vfat" issue. M'agradaria agraïr-li
a tots els meus amics pel seu suport i a tots aquells que van ser
suficientment pacients amb mi mentres completava aquest treball. Per
favor, escriga'm un correu a <url url="mailto:Rahulsundaram AT yahoo
DOT co DOT in" name="Rahul Sundaram"> in cas de suggerències, millores
o si vostè té idees brillants. Per favor esciga'm un correu si té bons
tutorials o coses que puc afegir a aquest document. Gràcies amb
antelació.  Li dedique aquest document als meus úlitms pares Mr.V.Sundaram
i Mrs.S.Soundara Sundaram.
</article>
